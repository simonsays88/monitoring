{% extends 'base.html.twig' %}

{% block pageTitle %}CostaFitness : Évolution athlète{% endblock %}
{% block headingTitle %}Évolution athlète ({{user.firstname}} {{user.lastname}}){% endblock %}
{% block pageClass %}userEvolution{% endblock %}

{% block head %}
    <script src="http://code.highcharts.com/highcharts.js"></script>
{% endblock %}

{% block body %}
    {% if user.packs.last.status == constant('AppBundle\\Entity\\Pack::STATUS_ONGOING') %}
        <p><a class="btn waves-effect waves-light" href="{{ path('stop_pack', {'pack_id' : user.packs.last.id}) }}" >Mettre en pause</a></p>
    {% endif %}
    {% if user.packs.last.status == constant('AppBundle\\Entity\\Pack::STATUS_PAUSE') %}
        <p><a class="btn waves-effect waves-light" href="{{ path('resume_pack', {'pack_id' : user.packs.last.id}) }}" >Reprendre</a></p>
    {% endif %}
    <h5>Mensurations</h5>
    <table class="bordered striped highlight responsive-table centered">
        <thead>
            <tr>
                <th>Bilans</th>
                <th>Poids</th>
                <th>Masse grasse</th>
                <th>Épaules</th>
                <th>Pectoraux</th>
                <th>Taille</th>
                <th>Bras contracté</th>
                <th>Cuisse</th>
            </tr>
        <thead>
        <tbody>
            <tr>
                <td><a href="{{ path('initial', {'userId':user.userId}) }}" class="link">Initial</a></td>
                <td>{{ user.weight}}</td>
                <td>{{ user.imc}}</td>
                <td>{{ user.shoulders}}</td>
                <td>{{ user.pectorals}}</td>
                <td>{{ user.hipSize}}</td>
                <td>{{ user.arms}}</td>
                <td>{{ user.thighs}}</td>
            </tr>
            {% for pack in user.packs %}
                {% for result in pack.results %}
                    <tr>
                        <td><a href="{{ path('results', {'resultId': result.id}) }}">{{ result.createdAt|date('d/m/Y') }}</a></td>
                        <td>{{ result.weight}}</td>
                        <td>{{ result.imc}}</td>
                        <td>{{ result.shoulders}}</td>
                        <td>{{ result.pectorals}}</td>
                        <td>{{ result.hipSize}}</td>
                        <td>{{ result.arms}}</td>
                        <td>{{ result.thighs}}</td>
                    </tr>
                {% endfor %}
            {% endfor %}
        </tbody>
    </table>
    <h5>Photos</h5>
    <table class="bordered striped highlight responsive-table centered">
        <thead>
            <tr>
                <th>Bilans</th>
                <th>Photo Face</th>
                <th>Photo Côté</th>
                <th>Photo Dos</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><a href="{{ path('initial', {'userId':user.userId}) }}" class="link">Initial</a></td>
                <td>
                    {% if user.photoFront is not null %}
                        <img width = "100px" src="{{ asset('uploads/photos/' ~ user.photoFront) }}" />
                    {% endif %}            
                </td>
                <td>
                    {% if user.photoSide is not null %}
                        <img width = "100px" src="{{ asset('uploads/photos/' ~ user.photoSide) }}" />
                    {% endif %}                
                </td>
                <td>
                    {% if user.photoBack is not null %}
                        <img width = "100px" src="{{ asset('uploads/photos/' ~ user.photoBack) }}" />
                    {% endif %}                
                </td>
            </tr>
            {% for pack in user.packs %}
                {% for result in pack.results %}
                    {% if result.resultType == constant('AppBundle\\Entity\\Result::ESTHETIC') %}
                        <tr>
                            <td><a href="{{ path('results', {'resultId': result.id}) }}">{{ result.createdAt|date('d/m/Y') }}</a></td>
                            <td>
                                {% if result.photoFront is not null %}
                                    <img width = "100px" src="{{ asset('uploads/photos/' ~ result.photoFront) }}" />
                                {% endif %}            
                            </td>
                            <td>
                                {% if result.photoSide is not null %}
                                    <img width = "100px" src="{{ asset('uploads/photos/' ~ result.photoSide) }}" />
                                {% endif %}                
                            </td>
                            <td>
                                {% if result.photoBack is not null %}
                                    <img width = "100px" src="{{ asset('uploads/photos/' ~ result.photoBack) }}" />
                                {% endif %}                
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        <tbody>
    </table>
    {% if performances is not null %}
        <h5>Performances</h5>
        <script>
            var data_repeat;
            var data_unit;
            var unit;
            var date;
            {% for key,exercise in performances %}

            </script>
            <div id="{{ key|replace(' ', '-') }}" class="higchart_line" style="width:50%; height:200px;"></div>
            <script>
                $(function () {
                    data_repeat = new Array();
                    data_unit = new Array();
                    date = new Array();
                {% for result in exercise %}
                        data_repeat.push({{ result[0] }});
                        data_unit.push({{ result[1] }});
                        date.push('{{ result[3]|date("d/m") }}');
                    {% if loop.first %}
                            unit = '{{ result[2] }}';
                    {% endif %}
                {% endfor %}

                        $('#{{ key|replace(' ', '-') }}').highcharts({
                            title: {
                                text: '{{ key }}',
                                x: -20 //center
                            },
                            xAxis: {
                                categories: date
                            },
                            yAxis: {
                                title: {
                                    text: 'Nb'
                                },
                                plotLines: [{
                                        value: 0,
                                        width: 1,
                                        color: '#808080'
                                    }]
                            },
                            legend: {
                                layout: 'vertical',
                                align: 'right',
                                verticalAlign: 'middle',
                                borderWidth: 0
                            },
                            series: [{
                                    name: 'Répétition',
                                    data: data_repeat
                                }, {
                                    name: unit,
                                    data: data_unit
                                }, ]
                        });
                    });
            {% endfor %}
        </script>

    {% endif %}

{% endblock %}
